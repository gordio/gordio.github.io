Крос-компиляция ядра на Gentoo

Решил опять попробовать 64 бита, вот только 64 битные бинарники запускать нельзя пока ядра не 64 битное. И что бы скомпилировать 64 битное ядро нужно 64 битное окружение. Хотя в нашем случае мы будем использовать просто особо скомпилированный компилятор.

## Установка нужных программ

crossdev - набор утилит который сделает установку всего вместо вас.

    emerge crossdev

Обязательно необходимо выбрать архитектуру на которую вы собираетесь компилировать. Для этого указываем это опцией -t, в моем случае это @x86_64-pc-linux-gnu@. И того у нас вышла вот такая команда:

    crossdev -t x86_64-pc-linux-gnu

Так же вы можете выбрать какое количество программ Вам понадобится. Это делается опцией -s[n], где [n] номер из ниже перечисленных:

* 0 - собрать только binutils
* 1 - собрать только C компилятор (не C библиотеки)
* 2 - собрать только заголовки ядра
* 3 - собрать только C библиотеки
* 4 - собрать полный компилятор [используется стандартно]

Так вышло что с первого раза оно не собралось, была куча ошибок на компиляции @gcc@. Немного помучившись решил все ошибки исправлением la файлов. (жаль у меня не было вовремя этой информации под рукой). Исправлять их можно и нужно прибегая к помощи @lafilefixer@:

    lafilefixer /lib

И запускаем опять @crossdev@.

## Компиляция ядра

До того как вы запустите сборку ядра его необходимо настроить для 64 битной системы. Здесь вопросов возникнуть не должно.

    cp -r /usr/src/linux{,64}   # Делаем копию исходников
    cd /usr/src/linux64         # переходим в каталог
    make mrproper               # очищаем его полностью
    cp ../.config ./            # используем старый конфиг
    make ARCH="x86_64" oldconfig # до настраиваем

# Ну и теперь можно компилировать

    make ARCH="x86_64" CROSS_COMPILE="x86_64-pc-linux-gnu-"

Удачной вам сборки и меньше паники ;Ъ
